---
description: "ステージングされているファイルを分析して、適切なコミットメッセージを生成する"
---

# commit-message

ステージングされたファイルの変更内容を分析し、プロジェクトの慣習に従った絵文字付き日本語コミットメッセージを生成します。

## 動作フロー

1. **ステージングファイルの確認**
   - `git diff --cached` で変更内容を取得
   - 変更されたファイルの種類と数を分析
   - 変更の規模（追加/削除行数）を確認

2. **過去のコミット分析**
   - `git log --oneline -20` で最近のコミットメッセージを取得
   - 使用されている絵文字パターンを学習
   - メッセージの形式と文体を分析

3. **変更内容の分類**
   - ファイルパスと拡張子から変更の種類を推測
   - 差分の内容から具体的な変更を理解
   - 複数の変更がある場合は主要な変更を特定

4. **メッセージ生成と提案**
   - 複数の候補を生成（通常3つ）
   - ユーザーが選択または編集可能
   - 選択されたメッセージをクリップボードにコピー

## 絵文字ガイドライン

### 主要な絵文字と使用シーン

| 絵文字 | 用途 | 具体例 |
|--------|------|---------|
| ✨ | 新機能の追加 | `✨ ユーザー認証機能を実装` |
| 🎨 | UI/スタイルの改善 | `🎨 ヘッダーのレイアウトを改善` |
| 📝 | ドキュメントの追加・更新 | `📝 README に使用方法を追加` |
| 🐛 | バグ修正 | `🐛 ログイン時のエラーを修正` |
| ♻️ | リファクタリング | `♻️ API クライアントのコードを整理` |
| 🔧 | 設定ファイルの変更 | `🔧 ESLint の設定を更新` |
| ➕ | 依存関係の追加 | `➕ axios を追加` |
| ➖ | 依存関係の削除 | `➖ 未使用のパッケージを削除` |
| 🚚 | ファイルの移動・リネーム | `🚚 components フォルダを再構成` |
| 🔥 | コードやファイルの削除 | `🔥 非推奨の API エンドポイントを削除` |
| ⚡ | パフォーマンス改善 | `⚡ 画像の遅延読み込みを実装` |
| 🔒 | セキュリティ修正 | `🔒 XSS 脆弱性を修正` |
| 🚧 | 作業中 | `🚧 ユーザープロフィール機能（WIP）` |
| ✅ | テストの追加・修正 | `✅ ユーザー認証のテストを追加` |
| 🚀 | デプロイ関連 | `🚀 本番環境用の設定を追加` |
| 💄 | UI/UXの細かい調整 | `💄 ボタンのホバーエフェクトを追加` |
| 🏗️ | アーキテクチャの変更 | `🏗️ MVC から MVP パターンに移行` |
| 🌐 | 国際化・地域化 | `🌐 英語の翻訳を追加` |
| ♿ | アクセシビリティ改善 | `♿ スクリーンリーダー対応を改善` |
| 🍱 | アセットの追加・更新 | `🍱 新しいアイコンセットを追加` |

### 複数変更時の絵文字選択

1. **主要な変更を優先**: 最も重要な変更を表す絵文字を使用
2. **新機能 > バグ修正 > リファクタリング**: この優先順位で選択
3. **複合的な場合**: より包括的な絵文字を選択

## メッセージフォーマット

### 基本形式
```
[絵文字] [変更内容の要約]

[詳細な説明（必要に応じて）]
```

### 良いメッセージの例
```
✨ ユーザープロフィール編集機能を追加

- プロフィール画像のアップロード機能
- 自己紹介文の編集
- SNSリンクの設定
```

```
🐛 ログイン後のリダイレクト処理を修正
```

```
♻️ API通信処理を共通化

すべてのAPIコールで共通のエラーハンドリングを使用するようにリファクタリング
```

### 避けるべきメッセージ
- ❌ `更新` （具体性がない）
- ❌ `バグ修正` （何のバグか不明）
- ❌ `✨ 🐛 ♻️ いろいろ修正` （絵文字の乱用）

## 実行例

```bash
$ claude commit-message

📊 ステージング中のファイルを分析しています...

変更されたファイル:
  M src/components/UserProfile.tsx
  A src/components/ProfileEditor.tsx
  M src/api/users.ts
  M src/styles/profile.css

📜 最近のコミットメッセージ:
  ✨ ユーザー一覧画面を実装
  🐛 ログイン時のトークン保存処理を修正
  🎨 ダークモードのスタイルを改善

💡 コミットメッセージの候補:

1. ✨ ユーザープロフィール編集機能を追加
2. ✨ プロフィール編集コンポーネントを実装
3. ✨ ユーザー情報の編集機能を追加

どれを使用しますか？ (1-3、または独自のメッセージを入力):
> 1

詳細な説明を追加しますか？ (y/n): y
> プロフィール画像のアップロードと基本情報の編集が可能

生成されたコミットメッセージ:
---
✨ ユーザープロフィール編集機能を追加

プロフィール画像のアップロードと基本情報の編集が可能
---

✅ メッセージをクリップボードにコピーしました！
git commit を実行してください。
```

## オプション

```bash
# シンプルモード（1行のみ）
claude commit-message --simple

# 英語でメッセージ生成
claude commit-message --lang en

# 絵文字なし
claude commit-message --no-emoji

# 特定のファイルのみ分析
claude commit-message --files src/components/*

# コミットも同時に実行
claude commit-message --commit

# 過去のメッセージ分析数を変更
claude commit-message --history 50
```

## 高度な機能

### AIによる変更内容の理解
- コードの意味的な変更を理解
- 単なるファイル名ではなく、実際の機能変更を認識
- 関連する変更をグループ化

### スマートな絵文字選択
```javascript
// 変更内容の例
+ import { uploadImage } from '@/api/upload'
+ const [image, setImage] = useState(null)

// AI の判断: ファイルアップロード機能の追加
// 推奨絵文字: ✨ (新機能)
```

### チーム慣習の学習
- プロジェクト固有の絵文字使用パターンを学習
- チーム特有の表現やフォーマットに適応
- 時間とともに精度が向上

### ステージングされたファイルがない場合
```bash
❌ ステージングされたファイルがありません。
先に `git add` でファイルをステージングしてください。
```

### 大量のファイル変更がある場合
```bash
⚠️ 25個以上のファイルが変更されています。
関連する変更ごとに分割してコミットすることを推奨します。

主な変更をグループ化しました:
1. ユーザー機能関連 (8ファイル)
2. スタイル調整 (12ファイル)
3. テスト追加 (5ファイル)

どのグループのメッセージを生成しますか？
```
